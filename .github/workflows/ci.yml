name: CI

# This workflow will run on push and pull request, and deploy the app if it passes.
# We use a matrix to test on different versions of Node.js.

# Controls when the action will run.
# For githug repository events, the following are supported:
# on: [push, pull_request]
# Allows you to run this workflow manually from the Actions tab
# on: workflow_dispatch

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # Build job
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [18.x, 20.x, 22.x]

    steps:
    - uses: actions/checkout@v4

    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm' # Use npm cache for faster dependency installation
        cache-dependency-path: '**/package-lock.json'

    - name: Install Dependencies
      run: npm ci # Use 'npm ci' for clean, reproducible installs

    - name: Linting with Ruff
      run: npm run lint # Assuming a lint script exists in package.json

    - name: Formatting with Ruff
      run: npm run format # Assuming a format script exists in package.json

    - name: Build Project
      run: npm run build # Assuming a build script exists in package.json

    - name: Run Unit Tests with Vitest
      run: npm test # Assuming a test script runs Vitest

    # Artifacts can be saved if needed, e.g., build output or test reports
    # - name: Upload build artifact
    #   uses: actions/upload-artifact@v4
    #   with:
    #     name: web-app-build
    #     path: dist/

  # Deploy job (example, can be expanded)
  # deploy:
  #   runs-on: ubuntu-latest
  #   needs: build # This job will only run if the build job succeeds
  #   steps:
  #   - name: Checkout code
  #     uses: actions/checkout@v4
  #   - name: Download build artifact
  #     uses: actions/download-artifact@v4
  #     with:
  #       name: web-app-build
  #       path: dist/
  #   - name: Deploy to Production
  #     # Replace with your actual deployment steps (e.g., using SCP, S3, Netlify CLI, Vercel CLI, etc.)
  #     run: | 
  #       echo "Deploying to production..."
  #       # Example: echo "Deploying to server at production-server.com"
